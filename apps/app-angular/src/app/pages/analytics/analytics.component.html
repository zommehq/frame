<app-page-layout title="Analytics Dashboard" subtitle="Demonstrating Transferable Objects (ArrayBuffer)">
	<div *ngIf="!isReady()" class="loading">Loading SDK...</div>
	<div *ngIf="isReady()" class="content">
		<div class="info-card">
			<h3>About Transferable Objects</h3>
			<p>
				This page demonstrates the use of <strong>Transferable Objects</strong> with ArrayBuffer. Data
				is serialized to binary format and transferred efficiently between the parent and child frames
				without copying, improving performance for large datasets.
			</p>
			<p *ngIf="lastUpdate()" class="last-update">
				Last updated: {{ lastUpdate()?.toLocaleTimeString() }}
			</p>
		</div>
		<div class="metrics-grid">
			<div class="metric-card">
				<div class="metric-icon">üìä</div>
				<div class="metric-content">
					<div class="metric-label">Total Tasks</div>
					<div class="metric-value">{{ metrics().tasksTotal }}</div>
				</div>
			</div>
			<div class="metric-card">
				<div class="metric-icon">‚úÖ</div>
				<div class="metric-content">
					<div class="metric-label">Completed</div>
					<div class="metric-value">{{ metrics().tasksCompleted }}</div>
				</div>
			</div>
			<div class="metric-card">
				<div class="metric-icon">üéØ</div>
				<div class="metric-content">
					<div class="metric-label">Completed Today</div>
					<div class="metric-value">{{ metrics().completedToday }}</div>
				</div>
			</div>
			<div class="metric-card">
				<div class="metric-icon">‚è±Ô∏è</div>
				<div class="metric-content">
					<div class="metric-label">Avg. Time</div>
					<div class="metric-value">{{ formattedTime() }}</div>
				</div>
			</div>
		</div>
		<div class="productivity-card">
			<h3>Productivity Score</h3>
			<div class="score-container">
				<div
					class="score-circle"
					[style.border-color]="getScoreColor(metrics().productivityScore)"
				>
					<span
						class="score-value"
						[style.color]="getScoreColor(metrics().productivityScore)"
					>
						{{ metrics().productivityScore }}%
					</span>
				</div>
				<div class="score-info">
					<p>
						Your productivity score is based on task completion rate.
						{{ getScoreMessage(metrics().productivityScore) }}
					</p>
				</div>
			</div>
		</div>
		<div class="actions">
			<button
				class="action-btn primary"
				[disabled]="isLoadingMetrics()"
				(click)="generateRandomMetrics()"
			>
				{{ isLoadingMetrics() ? "Generating..." : "Generate Random Metrics" }}
			</button>
			<button
				class="action-btn secondary"
				[disabled]="isLoadingMetrics()"
				(click)="sendMetricsToParent()"
			>
				Send to Parent (ArrayBuffer)
			</button>
			<button
				class="action-btn danger"
				[disabled]="isLoadingMetrics()"
				(click)="resetMetrics()"
			>
				Reset Metrics
			</button>
		</div>
		<div class="tech-details">
			<h4>Technical Details</h4>
			<ul>
				<li>
					<strong>Serialization:</strong> Metrics are encoded to UTF-8 bytes using TextEncoder
				</li>
				<li>
					<strong>Transfer:</strong> ArrayBuffer is transferred (not copied) via postMessage
				</li>
				<li>
					<strong>Performance:</strong> Zero-copy transfer improves performance for large data
				</li>
				<li><strong>Buffer Size:</strong> ~{{ bufferSize() }} bytes</li>
			</ul>
		</div>
	</div>
</app-page-layout>
