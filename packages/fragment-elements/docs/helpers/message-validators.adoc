= Message Validators

The message-validators module provides low-level message structure validation utilities used by both SDK and FragmentFrame.

== Overview

This module provides shared validation logic to reduce code duplication and ensure consistent validation across components.

== Import

[source,typescript]
----
import {
  isValidMessageStructure,
  hasStringType,
  isWhitelistedMessageType,
  validateMessage,
} from '@micro-fe/fragment-elements';
----

== Functions

=== `isValidMessageStructure(message)`

Check if message has valid structure (is object with type property).

**Parameters:**
* `message` (unknown) - Value to check

**Returns:** `message is { type: unknown }` - true if message has type property

**Example:**

[source,typescript]
----
import { isValidMessageStructure } from '@micro-fe/fragment-elements';

if (isValidMessageStructure(data)) {
  // data.type is available (typed as unknown)
  console.log('Message type:', data.type);
}
----

---

=== `hasStringType(message)`

Check if message type property is a string.

**Parameters:**
* `message` ({ type: unknown }) - Message with type property

**Returns:** `message is { type: string }` - true if type is string

**Example:**

[source,typescript]
----
import { hasStringType } from '@micro-fe/fragment-elements';

if (hasStringType(data)) {
  // data.type is now typed as string
  console.log('Message type:', data.type);
}
----

---

=== `isWhitelistedMessageType(type)`

Check if message type is in the whitelist of valid types.

**Parameters:**
* `type` (string) - Message type to check

**Returns:** `boolean` - true if type is valid

**Example:**

[source,typescript]
----
import { isWhitelistedMessageType, VALID_MESSAGE_TYPES } from '@micro-fe/fragment-elements';

if (isWhitelistedMessageType(data.type)) {
  console.log('Valid message type');
} else {
  console.warn('Unknown message type:', data.type);
}
----

---

=== `validateMessage(data, logPrefix)`

Complete message validation pipeline.

**Parameters:**
* `data` (unknown) - Data to validate
* `logPrefix` (string) - Prefix for log messages

**Returns:** `Message | null` - Validated message or null if invalid

**Example:**

[source,typescript]
----
import { validateMessage } from '@micro-fe/fragment-elements';

const message = validateMessage(event.data, '[fragment-frame]');
if (message) {
  // message is typed as Message
  switch (message.type) {
    case '__INIT__':
      // Handle init
      break;
    case '__READY__':
      // Handle ready
      break;
  }
}
----

---

== Usage in Components

=== FragmentFrame

[source,typescript]
----
import { validateMessage } from '../helpers/message-validators';

private _handleMessage(event: MessageEvent) {
  const message = validateMessage(event.data, '[fragment-frame]');
  if (!message) {
    return;
  }

  switch (message.type) {
    case MessageEvent.READY:
      this._ready = true;
      break;
  }
}
----

=== FrameSDK

[source,typescript]
----
import { validateMessage } from '../helpers/message-validators';

private _handleMessage(event: MessageEvent) {
  const message = validateMessage(event.data, '[frameSDK]');
  if (!message) {
    return;
  }

  switch (message.type) {
    case MessageEvent.EVENT:
      this._emitLocalEvent(message.name, message.data);
      break;
  }
}
----

---

== Related

* **Type Guards**: See link:./type-guards.adoc[Type Guards] for runtime type checking
* **Source Code**: `src/helpers/message-validators.ts`
