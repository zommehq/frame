= SDK API

The SDK provides APIs for fragment applications to communicate with the parent.

== Import

[source,typescript]
----
import { frameSDK } from '@micro-fe/fragment-elements/sdk';
----

NOTE: The SDK is a singleton instance. Import and use directly.

== Initialization

=== `initialize()`

Initialize the SDK. Must be called before using any other methods.

[source,typescript]
----
await frameSDK.initialize();
console.log('SDK ready');
----

**Returns:** `Promise<void>` - Resolves when `__INIT__` message received

IMPORTANT: Call `initialize()` at the start of your fragment application, before rendering UI.

== Configuration

=== `props`

Access configuration and properties passed from parent via the `props` property.

[source,typescript]
----
const config = frameSDK.props;
console.log(config.name);     // "my-app"
console.log(config.base);     // "/my-app"
console.log(config.apiUrl);   // Custom attribute
console.log(config.theme);    // Custom attribute
----

**Type:** `FragmentFrameProps` - Configuration object with all attributes and properties

Properties are automatically updated when parent changes attributes:

[source,typescript]
----
// Parent changes theme
fragment.theme = 'dark';

// Fragment's props are updated automatically
console.log(frameSDK.props.theme); // "dark"
----

== Events

=== `emit(eventName, data?)`

Emit custom event to parent.

[source,typescript]
----
frameSDK.emit('user-action', { type: 'click', id: 123 });
frameSDK.emit('data-loaded');
----

**Parameters:**
* `eventName` (string) - Event name
* `data` (unknown, optional) - Event data

=== `on(eventName, handler)`

Listen to events from parent.

[source,typescript]
----
frameSDK.on('theme-changed', (theme) => {
  console.log('New theme:', theme);
  updateTheme(theme);
});

frameSDK.on('user-updated', (user) => {
  console.log('User updated:', user);
});
----

**Parameters:**
* `eventName` (string) - Event name
* `handler` (function) - Event handler `(data: unknown) => void`

==== Attribute Change Events

Listen to attribute changes with `attr:` prefix:

[source,typescript]
----
frameSDK.on('attr:apiUrl', (newUrl) => {
  console.log('API URL changed:', newUrl);
  updateApiClient(newUrl);
});

frameSDK.on('attr:theme', (theme) => {
  console.log('Theme changed:', theme);
});
----

NOTE: Use camelCase for attribute names (e.g., `attr:apiUrl` for the `api-url` attribute).

=== `off(eventName, handler)`

Remove event listener.

[source,typescript]
----
const handler = (data) => console.log(data);

frameSDK.on('user-updated', handler);
frameSDK.off('user-updated', handler);
----

**Parameters:**
* `eventName` (string) - Event name
* `handler` (function) - Handler to remove

== Lifecycle

=== `cleanup()`

Clean up resources when unmounting the fragment.

[source,typescript]
----
// React
useEffect(() => {
  return () => frameSDK.cleanup();
}, []);

// Vue
onUnmounted(() => {
  frameSDK.cleanup();
});

// Angular
ngOnDestroy() {
  frameSDK.cleanup();
}
----

**Purpose:** Removes all event listeners, closes MessagePort, and releases function references to prevent memory leaks.

IMPORTANT: Always call `cleanup()` when unmounting your fragment to avoid memory leaks.

== TypeScript Types

Extend `FragmentFrameProps` for type-safe access to custom properties:

[source,typescript]
----
import type { FragmentFrameProps } from '@micro-fe/fragment-elements/types';

interface MyFragmentProps extends FragmentFrameProps {
  apiUrl: string;
  theme: 'light' | 'dark';
  userId: string;
  onSave: (data: unknown) => Promise<void>;
}

const props = frameSDK.props as MyFragmentProps;
console.log(props.apiUrl);  // Type-safe
await props.onSave({ name: 'John' }); // Type-safe function call
----

== Parent-Provided Functions

The parent can pass functions as properties, which can be called from the fragment:

[source,typescript]
----
// Parent provides callback
fragment.onSave = async (data) => {
  await api.save(data);
  return { success: true };
};

// Fragment calls it
const result = await frameSDK.props.onSave({ name: 'John' });
console.log(result); // { success: true }
----

**Function call timeout:** 5 seconds. If a function call doesn't respond within 5 seconds, it will throw a timeout error.

== Example: Complete Setup

[source,typescript]
----
import { frameSDK } from '@micro-fe/fragment-elements/sdk';

// 1. Initialize
await frameSDK.initialize();

// 2. Access props
console.log('Fragment started:', frameSDK.props.name);
console.log('Base path:', frameSDK.props.base);

// 3. Listen to attribute changes
frameSDK.on('attr:theme', (theme) => {
  applyTheme(theme);
});

frameSDK.on('attr:apiUrl', (url) => {
  updateApiClient(url);
});

// 4. Listen to custom events
frameSDK.on('refresh-data', () => {
  loadData();
});

// 5. Emit events
button.addEventListener('click', () => {
  frameSDK.emit('button-clicked', { id: 'save' });
});

// 6. Call parent functions
async function saveData(data) {
  try {
    const result = await frameSDK.props.onSave(data);
    console.log('Saved:', result);
  } catch (error) {
    console.error('Save failed:', error);
  }
}

// 7. Cleanup on unmount
// React
useEffect(() => {
  return () => frameSDK.cleanup();
}, []);

// Vue
onUnmounted(() => frameSDK.cleanup());

// Angular
ngOnDestroy() {
  frameSDK.cleanup();
}
----
