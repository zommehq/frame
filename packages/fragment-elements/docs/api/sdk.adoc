= SDK API

The SDK provides APIs for fragment applications to communicate with the parent.

== Import

[source,typescript]
----
import { microAppSDK } from '@micro-fe/fragment-elements/sdk';
----

NOTE: The SDK is a singleton instance. Import and use directly.

== Initialization

=== `initialize()`

Initialize the SDK. Must be called before using any other methods.

[source,typescript]
----
await microAppSDK.initialize();
console.log('SDK ready');
----

**Returns:** `Promise<void>` - Resolves when `__INIT__` message received

IMPORTANT: Call `initialize()` at the start of your fragment application, before rendering UI.

== Configuration

=== `getConfig()`

Get the configuration passed from parent.

[source,typescript]
----
const config = microAppSDK.getConfig();
console.log(config.name);     // "my-app"
console.log(config.base);     // "/my-app"
console.log(config.apiUrl);   // Custom attribute
console.log(config.theme);    // Custom attribute
----

**Returns:** `FragmentFrameConfig` - Configuration object

== Navigation

=== `navigate(path, replace?, state?)`

Request parent to navigate to a path.

[source,typescript]
----
// Push navigation
microAppSDK.navigate('/my-app/settings');

// Replace navigation
microAppSDK.navigate('/my-app/home', true);

// With state
microAppSDK.navigate('/my-app/profile', false, { from: 'dashboard' });
----

**Parameters:**
* `path` (string) - Target path
* `replace` (boolean, optional) - Replace history instead of push. Default: `false`
* `state` (unknown, optional) - Navigation state

NOTE: The parent application is responsible for handling navigation. Listen to the `navigate` event on the `<fragment-frame>` element.

== Events

=== `emit(eventName, data?)`

Emit custom event to parent.

[source,typescript]
----
microAppSDK.emit('user-action', { type: 'click', id: 123 });
microAppSDK.emit('data-loaded');
----

**Parameters:**
* `eventName` (string) - Event name
* `data` (unknown, optional) - Event data

=== `on(eventName, handler)`

Listen to events from parent.

[source,typescript]
----
microAppSDK.on('theme-changed', (theme) => {
  console.log('New theme:', theme);
  updateTheme(theme);
});

microAppSDK.on('user-updated', (user) => {
  console.log('User updated:', user);
});
----

**Parameters:**
* `eventName` (string) - Event name
* `handler` (function) - Event handler `(data: unknown) => void`

==== Attribute Change Events

Listen to attribute changes with `attribute:` prefix:

[source,typescript]
----
microAppSDK.on('attribute:api-url', (newUrl) => {
  console.log('API URL changed:', newUrl);
  updateApiClient(newUrl);
});

microAppSDK.on('attribute:theme', (theme) => {
  console.log('Theme changed:', theme);
});
----

=== `off(eventName, handler)`

Remove event listener.

[source,typescript]
----
const handler = (data) => console.log(data);

microAppSDK.on('user-updated', handler);
microAppSDK.off('user-updated', handler);
----

**Parameters:**
* `eventName` (string) - Event name
* `handler` (function) - Handler to remove

== Methods

=== `registerMethod(method, handler)`

Register a method that can be called from parent.

[source,typescript]
----
microAppSDK.registerMethod('getUserData', async (params) => {
  const { id } = params as { id: number };
  const user = await fetchUser(id);
  return user;
});

microAppSDK.registerMethod('refresh', () => {
  location.reload();
});
----

**Parameters:**
* `method` (string) - Method name
* `handler` (function) - Method handler `(params: unknown) => unknown | Promise<unknown>`

**Handler returns:** Any value (will be sent to parent)

**Handler throws:** Error (will be sent to parent as error)

== Error Reporting

=== `reportError(error)`

Report error to parent.

[source,typescript]
----
try {
  await riskyOperation();
} catch (error) {
  microAppSDK.reportError(error as Error);
}
----

**Parameters:**
* `error` (Error) - Error to report

NOTE: Parent can listen to `error` event on `<fragment-frame>` element.

== State Management

=== `notifyStateChange(state)`

Notify parent of state changes.

[source,typescript]
----
const state = {
  user: currentUser,
  theme: currentTheme,
  language: currentLanguage,
};

microAppSDK.notifyStateChange(state);
----

**Parameters:**
* `state` (unknown) - Current state

NOTE: Parent can listen to `state-change` event on `<fragment-frame>` element.

== TypeScript Types

[source,typescript]
----
import type { FragmentFrameConfig } from '@micro-fe/fragment-elements/types';

interface MyConfig extends FragmentFrameConfig {
  apiUrl: string;
  theme: 'light' | 'dark';
  userId: string;
}

const config = microAppSDK.getConfig() as MyConfig;
console.log(config.apiUrl);  // Type-safe
----

== Example: Complete Setup

[source,typescript]
----
import { microAppSDK } from '@micro-fe/fragment-elements/sdk';

// 1. Initialize
await microAppSDK.initialize();

// 2. Get config
const config = microAppSDK.getConfig();
console.log('Fragment started:', config.name);

// 3. Register methods
microAppSDK.registerMethod('getData', async () => {
  return { items: [...] };
});

// 4. Listen to events
microAppSDK.on('attribute:theme', (theme) => {
  applyTheme(theme);
});

microAppSDK.on('refresh-data', () => {
  loadData();
});

// 5. Emit events
button.addEventListener('click', () => {
  microAppSDK.emit('button-clicked', { id: 'save' });
});

// 6. Request navigation
function goToSettings() {
  microAppSDK.navigate(`${config.base}/settings`);
}

// 7. Report errors
window.addEventListener('error', (event) => {
  microAppSDK.reportError(event.error);
});
----
