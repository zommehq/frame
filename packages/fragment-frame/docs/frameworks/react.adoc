= React Integration

Fragment Frame works seamlessly with React in both parent and child applications.

== Parent Application (React)

=== Using the React Package (Recommended)

The `@zomme/fragment-frame-react` package provides a React component wrapper for easier integration:

[source,bash]
----
bun add @zomme/fragment-frame-react
----

[source,tsx]
----
import { FragmentFrame } from '@zomme/fragment-frame-react';

function App() {
  return (
    <FragmentFrame
      name="user-app"
      src="http://localhost:3001"
      base="/users"
      theme="dark"
      apiUrl="https://api.example.com"
      onSave={async (data) => {
        await api.save(data);
        return { success: true };
      }}
      onReady={() => console.log('Fragment ready!')}
    />
  );
}
----

**Features:**
- Type-safe props with full TypeScript support
- Automatic property updates (including functions)
- Event listeners via props (`onReady`, `onNavigate`, etc.)
- No need to manually handle refs or element attributes

=== Using the Web Component Directly

Alternatively, you can use the core web component directly:

[source,tsx]
----
import '@zomme/fragment-frame';

function App() {
  return (
    <fragment-frame
      name="user-app"
      src="http://localhost:3001"
      base="/users"
      theme="dark"
    />
  );
}
----

=== Type-Safe Component Wrapper

[source,tsx]
----
import '@zomme/fragment-frame';
import { useEffect, useRef } from 'react';
import type { FragmentFrame } from '@zomme/fragment-frame';

interface FragmentProps {
  apiUrl: string;
  name: string;
  onSave?: (data: unknown) => Promise<void>;
  src: string;
  theme: 'light' | 'dark';
}

export function Fragment({ name, src, ...props }: FragmentProps) {
  const ref = useRef<FragmentFrame>(null);

  useEffect(() => {
    const element = ref.current;
    if (!element) return;

    // Assign props (including functions)
    Object.assign(element, props);
  }, [props]);

  return <fragment-frame ref={ref} name={name} src={src} />;
}
----

=== Listening to Events

[source,tsx]
----
import { useEffect, useRef } from 'react';
import type { FragmentFrame } from '@zomme/fragment-frame';

function App() {
  const fragmentRef = useRef<FragmentFrame>(null);

  useEffect(() => {
    const fragment = fragmentRef.current;
    if (!fragment) return;

    const handleReady = () => console.log('Fragment ready');
    const handleUserAction = (e: Event) => console.log((e as CustomEvent).detail);

    fragment.addEventListener('ready', handleReady);
    fragment.addEventListener('user-action', handleUserAction);

    return () => {
      fragment.removeEventListener('ready', handleReady);
      fragment.removeEventListener('user-action', handleUserAction);
    };
  }, []);

  return <fragment-frame ref={fragmentRef} name="app" src="http://localhost:3000" />;
}
----

== Fragment Application (React)

=== Using the React Package

The `@zomme/fragment-frame-react` package provides ready-to-use components and hooks for React applications.

[source,tsx]
----
import { useFrameSDK } from '@zomme/fragment-frame-react';

function App() {
  const { emit, isReady, on, onAttr, props, sdkAvailable } = useFrameSDK();

  return (
    <div data-theme={props.theme}>
      <h1>Fragment: {props.name}</h1>
      {isReady && <p>SDK initialized and ready</p>}
      {!sdkAvailable && <p>Running standalone (not in a frame)</p>}
    </div>
  );
}
----

=== Hook Return Values

The `useFrameSDK` hook returns the following fields:

[cols="1,1,3"]
|===
|Field |Type |Description

|`props`
|`T`
|Current properties passed from the parent application

|`emit`
|`(eventName: string, data?: unknown) => void`
|Function to emit events to the parent application

|`isReady`
|`boolean`
|Indicates if the SDK is fully initialized and ready to communicate

|`sdkAvailable`
|`boolean`
|Indicates if the application is running inside a fragment frame (true) or standalone (false)

|`on`
|`(eventName: string, handler: Function) => void`
|Function to listen to events from the parent application

|`onAttr`
|`(attrName: string, handler: Function) => void`
|Function to listen to specific attribute changes (e.g., `onAttr('theme', handleThemeChange)`)
|===

=== Basic Setup (Manual SDK)

You can also use the SDK directly without the React package:

[source,tsx]
----
import { StrictMode } from 'react';
import { createRoot } from 'react-dom/client';
import { frameSDK } from '@zomme/fragment-frame/sdk';

function App() {
  return (
    <div data-theme={frameSDK.props.theme}>
      <h1>Fragment: {frameSDK.props.name}</h1>
    </div>
  );
}

frameSDK.initialize().then(() => {
  createRoot(document.getElementById('root')!).render(
    <StrictMode>
      <App />
    </StrictMode>
  );
});
----

=== Listening to Events

[source,tsx]
----
import { useFrameSDK } from '@zomme/fragment-frame-react';
import { useEffect } from 'react';

function App() {
  const { on, onAttr, props } = useFrameSDK();

  useEffect(() => {
    // Listen to custom events from parent
    on('user-action', (data) => {
      console.log('User action:', data);
    });

    // Listen to specific attribute changes
    onAttr('theme', (newTheme) => {
      console.log('Theme changed to:', newTheme);
    });
  }, [on, onAttr]);

  return <div data-theme={props.theme}>Content</div>;
}
----
